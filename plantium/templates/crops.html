{% extends "layouts/base.html" %} {% load custom_filters %}{% load static %} {% block content %}

<div class="col-lg-10 ml-sm-auto px-4">
  <!-- Cultivos en curso -->
  <div class="d-flex flex-row align-items-center my-sm-5 gap-3">
    <h2>Cultivos en curso</h3>
    <div class="pt-2">
      <a href="/crop/create" class="btn create-crop-button mb-3 grow">Iniciar nuevo cultivo</a>
    </div>
  </div>
  {% if not actives %}
    <div class="d-flex justify-content-center">
      <div class="alert alert-info text-center" style="width: 90%">No hay cultivos en curso.</div>
    </div>
  {% endif %}

  <div class="row d-md-flex justify-content-center">
    {% for crop in actives %}
    <div class="col-md-5 mb-4">
      <div class="card shadow-sm border-0 rounded-4 mb-4" style="overflow: hidden;">
        <!-- Imagen superior -->

        <div class="d-flex justify-content-end">
          <a href="{% url 'delete_crop' crop.id %}" class="btn delete-icons">
            <i class="bi bi-trash-fill fs-4"></i>
          </a>
        </div>
        
        <img
          src="{% static crop.plant.img_url %}"
          class="card-img-top"
          alt="{{ crop.plant.name }}"
          style="height: 200px; object-fit: cover;"
        />

        <div class="card-body text-center">
          <!-- Título -->
          <h5 class="fw-bold text-uppercase">{{ crop.name }}</h5>

          <!-- Información -->
          <p class="text-muted small mb-1">Fecha de inicio: {{ crop.init_date }}</p>

          <hr />

          <div class="row px-sm-3">
            <div class="col-lg-6 text-lg-start">
              <p class="mb-1"><strong>Planta</strong> <br>{{ crop.plant.name }}</p>
              <p class="mb-1"><strong>Variedad</strong> <br>{{ crop.plant.variety }}</p>
              <p class="mb-1">
                <strong>Último riego</strong><br>
                {% if crop.last_watering is none %}
                  <span class="text-danger">No se ha regado</span>
                {% else %}
                  {{ crop.last_watering }}
                {% endif %}
              </p>
            </div>

            <div class="col-lg-6 text-lg-end">
              <p class="mb-3">
                {% if crop.days_remaining > 0 %}
                  La debes regar en <br><strong>{{ crop.days_remaining }}</strong> días
                {% elif crop.days_remaining < 0 %}
                  Riego atrasado por: <br><strong>{{ crop.days_remaining|abs_val }}</strong> días
                {% elif crop.days_remaining == 1 %}
                  La debes regar <br><strong>mañana</strong>
                {% else %}
                  La debes regar <br><strong>hoy</strong>
                {% endif %}
              </p>
            </div>
          </div>

          <!-- Botones -->
          <div class="d-flex justify-content-center gap-2 mt-4">
            <a href="{% url 'update_crop' crop.id %}" class="btn btn-sm btn-success btn-card-crop">Actualizar</a>
            <a href="{% url 'culminate_crop' crop.id %}" class="btn btn-sm btn-outline-danger btn-card-crop">Terminar</a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <hr class="my-4">  

  <!-- Cultivos terminados -->
  <h2 class="my-4">Cultivos terminados</h3>
  {% if not finished %}
  <div class="d-flex justify-content-center">
  <div class="alert alert-info text-center"  style="width: 90%">No hay cultivos terminados.</div>
  </div>
  {% endif %}

<div class="row d-md-flex justify-content-center">
  {% for crop in finished %}
  <div class="col-md-5 mb-4">
    <div class="card shadow-sm border-0 rounded-4 h-100 bg-light">
        <img
          src="{% static crop.plant.img_url %}"
          class="card-img-top"
          alt="{{ crop.plant.name }}"
          style="height: 200px; object-fit: cover;"
        />
      <div class="card-body">
        <h5 class="card-title"><strong>{{ crop.name }}</strong></h5>
        <p class="text-muted small mb-1">Fecha de inicio: {{ crop.init_date }}</p>
        <p class="mb-3">
          <strong>Último riego:</strong>
          {% if crop.last_watering is none %}
            No se ha regado
          {% else %}
            {{ crop.last_watering }}
          {% endif %}
        </p>
        <a href="{% url 'delete_crop' crop.id %}" class="btn btn-sm btn-outline-danger">Eliminar</a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

  <!-- Link recuperar -->
  <div class="mt-4 ms-4 d-flex justify-content-start">
    <p class="small">
      Para recuperar tus cultivos eliminados presiona
      <a href="{% url 'deleted_crops' %}" class="text-primary" >aquí.</a>
    </p>
  </div>
</div>

{% endblock %}

